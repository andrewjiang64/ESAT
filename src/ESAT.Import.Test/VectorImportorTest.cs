using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Collections.Generic;
using ESAT.Import.Model;
using System;
using AgBMPTool.DBModel.Model.ModelComponent;
using AgBMPTool.DBModel.Model;

namespace ESAT.Import.Test.Application
{
    [TestClass]
    public class VectorImportorTest
    {
        [TestMethod]
        public void ImportAllVectors()
        {
            //throw new NotImplementedException();

        }

        [TestMethod]
        public void ImportOneVector()
        {
            //throw new NotImplementedException();

        }

        [TestMethod]
        public void UpdateGeometry()
        {
            // Arrange
            Watershed obj = new Watershed { Id = 0 };
            string geomWKT = "MULTIPOLYGON(((-113.817426722954 49.4615133098004,-113.817771784724 49.4615168377099,-113.817766372991 49.4617417521344,-113.817421309642 49.461738224197,-113.817426722954 49.4615133098004)),((-113.817766372991 49.4617417521344,-113.818111436407 49.4617452790425,-113.818106026185 49.4619701934856,-113.81776096119 49.4619666665497,-113.817766372991 49.4617417521344)),((-113.817426722954 49.4615133098004,-113.816391538051 49.4615027198965,-113.816386120003 49.4617276342096,-113.816041056925 49.4617241021553,-113.816035637231 49.4619490164312,-113.815690572643 49.4619454833198,-113.815685151302 49.4621703975586,-113.815340085203 49.46216686339,-113.815334662216 49.4623917775917,-113.813609324844 49.4623740911706,-113.813603893895 49.4625990052234,-113.811878550329 49.4625812929311,-113.811873111419 49.4628062068348,-113.811182971311 49.4627991146571,-113.811188413378 49.4625742008094,-113.810153208463 49.4625635549074,-113.810158655199 49.4623386411345,-113.809468522087 49.4623315387762,-113.809463072194 49.4625564524931,-113.809118004161 49.4625528997421,-113.809112552621 49.4627778134216,-113.808767483079 49.4627742596133,-113.808762029892 49.4629991732555,-113.808416958838 49.4629956183899,-113.808422413604 49.4627707047757,-113.808077344197 49.4627671489088,-113.808082800474 49.4625422353135,-113.807737732714 49.4625386784454,-113.807743190501 49.4623137648689,-113.806707992368 49.4623030881736,-113.806713454822 49.4620781746721,-113.806368390494 49.4620746137433,-113.806373854458 49.4618497002607,-113.806028791776 49.4618461383308,-113.806034257251 49.4616212248671,-113.80534413525 49.4616140979758,-113.805349603814 49.4613891845591,-113.805004544494 49.4613856195978,-113.805010014568 49.4611607062001,-113.804664956896 49.4611571402377,-113.80467042848 49.4609322268589,-113.804325372454 49.4609286598954,-113.804330845549 49.4607037465355,-113.80398579117 49.4607001785711,-113.803991265774 49.4604752652301,-113.80330116038 49.46046812627,-113.803306638073 49.4602432129762,-113.802961587057 49.4602396419806,-113.802956107786 49.4604645552463,-113.80261105526 49.4604609831933,-113.802605574342 49.4606858964216,-113.801915466339 49.4606787491717,-113.801909982195 49.4609036623343,-113.80121987131 49.4608965109113,-113.80121438394 49.4611214240081,-113.800869327022 49.4611178467246,-113.800863838005 49.461342759784,-113.800518779577 49.461339181443,-113.80050779818 49.4617890074775,-113.800162736663 49.4617854280508,-113.800157244283 49.462010341026,-113.799812181257 49.4620067605418,-113.799806687229 49.4622316734794,-113.799116558225 49.4622245093668,-113.799127552526 49.4617746835955,-113.798782491284 49.4617711000519,-113.798776992589 49.4619960129139,-113.79705167952 49.4619780796163,-113.797057186108 49.4617531668958,-113.796367064519 49.4617459864289,-113.796372574195 49.4615210737559,-113.796027515083 49.461517482007,-113.796033026269 49.4612925693531,-113.795342911408 49.4612853828244,-113.795348425682 49.461060470218,-113.795003369934 49.4610568754383,-113.795008885718 49.460831962851,-113.794318777585 49.4608247702607,-113.794324296457 49.460599857721,-113.793979244073 49.4605962599105,-113.794012365322 49.4592467846484,-113.794357408236 49.4592503822885,-113.794384999486 49.4581258191737,-113.794730034577 49.4581294156427,-113.794746583764 49.4574546775777,-113.795091614189 49.4574582729324,-113.795102643479 49.4570084474527,-113.795447670816 49.4570120417217,-113.79545318378 49.4567871289396,-113.796143235505 49.4567943143336,-113.796488261472 49.4567979054871,-113.796493769631 49.4565729926107,-113.796838794088 49.4565765827068,-113.796844300601 49.4563516697928,-113.797879369651 49.456362433822,-113.79788487136 49.4561375208137,-113.798229892936 49.4561411067371,-113.798240892993 49.4556912806363,-113.798585911482 49.4556948654741,-113.798613402528 49.4545702999188,-113.799303423932 49.4545774662244,-113.799308918779 49.454352553029,-113.799653928006 49.4543561346101,-113.799659421206 49.4541312213773,-113.800004428924 49.4541348019012,-113.800009920477 49.4539098886307,-113.800354926686 49.4539134680974,-113.800360416593 49.4536885547896,-113.800705421292 49.4536921331991,-113.800710909552 49.4534672198537,-113.801055912742 49.453470797206,-113.801061399356 49.4532458838231,-113.802096404604 49.453256609622,-113.802107368159 49.4528067826591,-113.802452366889 49.4528103558112,-113.802446886724 49.4530352693255,-113.803136887547 49.4530424125993,-113.803131410469 49.4532673261607,-113.803476412561 49.4532708962824,-113.803470936992 49.4534958098628,-113.803125933322 49.4534922397128,-113.803109501471 49.4541669803139,-113.803454509874 49.4541705505483,-113.803449034032 49.4543954640917,-113.803794044082 49.4543990333255,-113.803783095347 49.4548488604409,-113.804128108621 49.4548524287019,-113.804122635729 49.455077342274,-113.80446765065 49.4550809095342,-113.804451236297 49.4557556502793,-113.804796256021 49.4557592165951,-113.804790786011 49.4559841301865,-113.805135807381 49.4559876955014,-113.805141275813 49.4557627818819,-113.805486295674 49.4557663461396,-113.805491762459 49.4555414324827,-113.80583678081 49.4555449956833,-113.805831315603 49.4557699093684,-113.807211396002 49.4557841519933,-113.807205937039 49.4560090657816,-113.807550958888 49.4560126238934,-113.807545501435 49.4562375377004,-113.80789052493 49.4562410948113,-113.807885068987 49.4564660086373,-113.808230094128 49.4564695647472,-113.808224639695 49.4566944785919,-113.808569666483 49.4566980337009,-113.80856421356 49.4569229475645,-113.808909241994 49.4569265016725,-113.808903790581 49.4571514155549,-113.809248820661 49.4571549686619,-113.809243370758 49.4573798825631,-113.809588402485 49.4573834346691,-113.809582954092 49.4576083485891,-113.809927987466 49.457611899694,-113.809922540583 49.4578368136329,-113.810267575603 49.4578403637367,-113.81026213023 49.4580652776944,-113.810607166896 49.4580688267972,-113.810601723034 49.4582937407736,-113.812671953933 49.4583150139474,-113.812666519472 49.4585399280825,-113.813011559772 49.4585434700376,-113.813006126821 49.4587683841915,-113.813351168767 49.4587719251454,-113.813345737327 49.458996839318,-113.813690780919 49.4590003792707,-113.81368535099 49.459225293462,-113.814030396229 49.4592288324135,-113.81402496781 49.4594537466235,-113.814370014695 49.4594572845739,-113.814364587786 49.4596821988026,-113.814709636317 49.4596857357517,-113.81470421092 49.4599106499991,-113.815049261097 49.4599141859469,-113.81504383721 49.460139100213,-113.815733940926 49.4601461690771,-113.815728520128 49.4603710833897,-113.816073573666 49.4603746163059,-113.816068154379 49.4605995306372,-113.816413209563 49.4606030625521,-113.816407791787 49.460827976902,-113.816752848618 49.4608315078156,-113.816747432352 49.4610564221842,-113.817092490829 49.4610599520964,-113.817087076074 49.4612848664836,-113.817432136198 49.4612883953945,-113.817426722954 49.4615133098004)))";
            int projCode = 3400;
            int standardCode = 4326;
            geomWKT = $"ST_Transform(ST_Multi(ST_geomFromText('{geomWKT}',{projCode})),{standardCode})";
            VectorImportor vi = new VectorImportor();
            string sql = vi.GetUpdateGeometrySQL(obj, geomWKT);

            int expectResult = 0;

            // Act
            int result = vi.UpdateGeometry(new System.Text.StringBuilder().AppendLine(sql));

            // Assert
            Assert.AreEqual(expectResult, result);
        }

        [TestMethod]
        public void GetDBObjectOCR()
        {
            // Arrange
            Dictionary<string, string> feature = new Dictionary<string, string>
            {
                ["id"] = "1",
                ["name"] = "name",
                ["alias"] = "alias",
                ["shape_area"] = "10000",
                ["descriptio"] = "descriptio",
                ["outletreac"] = "1"
            };
            Type type = typeof(Watershed);
            int mcID = 1;

            // Act
            Object obj = new VectorImportor().GetDBObject(type, feature, mcID, null);

            // Assert
            Assert.AreEqual(obj.GetType(), type);
            Assert.AreEqual(((Watershed)obj).Name, "name");
            Assert.AreEqual(((Watershed)obj).Alias, "alias");
            Assert.AreEqual(((Watershed)obj).Area, 1);
            Assert.AreEqual(((Watershed)obj).Description, "descriptio");
            Assert.AreNotEqual(((Watershed)obj).Id, 1);
        }

        [TestMethod]
        public void GetUpdateGeometrySQL()
        {
            // Arrange
            Watershed obj = new Watershed();
            string geomWKT = "MULTIPOLYGON(((-113.817426722954 49.4615133098004,-113.817771784724 49.4615168377099,-113.817766372991 49.4617417521344,-113.817421309642 49.461738224197,-113.817426722954 49.4615133098004)),((-113.817766372991 49.4617417521344,-113.818111436407 49.4617452790425,-113.818106026185 49.4619701934856,-113.81776096119 49.4619666665497,-113.817766372991 49.4617417521344)),((-113.817426722954 49.4615133098004,-113.816391538051 49.4615027198965,-113.816386120003 49.4617276342096,-113.816041056925 49.4617241021553,-113.816035637231 49.4619490164312,-113.815690572643 49.4619454833198,-113.815685151302 49.4621703975586,-113.815340085203 49.46216686339,-113.815334662216 49.4623917775917,-113.813609324844 49.4623740911706,-113.813603893895 49.4625990052234,-113.811878550329 49.4625812929311,-113.811873111419 49.4628062068348,-113.811182971311 49.4627991146571,-113.811188413378 49.4625742008094,-113.810153208463 49.4625635549074,-113.810158655199 49.4623386411345,-113.809468522087 49.4623315387762,-113.809463072194 49.4625564524931,-113.809118004161 49.4625528997421,-113.809112552621 49.4627778134216,-113.808767483079 49.4627742596133,-113.808762029892 49.4629991732555,-113.808416958838 49.4629956183899,-113.808422413604 49.4627707047757,-113.808077344197 49.4627671489088,-113.808082800474 49.4625422353135,-113.807737732714 49.4625386784454,-113.807743190501 49.4623137648689,-113.806707992368 49.4623030881736,-113.806713454822 49.4620781746721,-113.806368390494 49.4620746137433,-113.806373854458 49.4618497002607,-113.806028791776 49.4618461383308,-113.806034257251 49.4616212248671,-113.80534413525 49.4616140979758,-113.805349603814 49.4613891845591,-113.805004544494 49.4613856195978,-113.805010014568 49.4611607062001,-113.804664956896 49.4611571402377,-113.80467042848 49.4609322268589,-113.804325372454 49.4609286598954,-113.804330845549 49.4607037465355,-113.80398579117 49.4607001785711,-113.803991265774 49.4604752652301,-113.80330116038 49.46046812627,-113.803306638073 49.4602432129762,-113.802961587057 49.4602396419806,-113.802956107786 49.4604645552463,-113.80261105526 49.4604609831933,-113.802605574342 49.4606858964216,-113.801915466339 49.4606787491717,-113.801909982195 49.4609036623343,-113.80121987131 49.4608965109113,-113.80121438394 49.4611214240081,-113.800869327022 49.4611178467246,-113.800863838005 49.461342759784,-113.800518779577 49.461339181443,-113.80050779818 49.4617890074775,-113.800162736663 49.4617854280508,-113.800157244283 49.462010341026,-113.799812181257 49.4620067605418,-113.799806687229 49.4622316734794,-113.799116558225 49.4622245093668,-113.799127552526 49.4617746835955,-113.798782491284 49.4617711000519,-113.798776992589 49.4619960129139,-113.79705167952 49.4619780796163,-113.797057186108 49.4617531668958,-113.796367064519 49.4617459864289,-113.796372574195 49.4615210737559,-113.796027515083 49.461517482007,-113.796033026269 49.4612925693531,-113.795342911408 49.4612853828244,-113.795348425682 49.461060470218,-113.795003369934 49.4610568754383,-113.795008885718 49.460831962851,-113.794318777585 49.4608247702607,-113.794324296457 49.460599857721,-113.793979244073 49.4605962599105,-113.794012365322 49.4592467846484,-113.794357408236 49.4592503822885,-113.794384999486 49.4581258191737,-113.794730034577 49.4581294156427,-113.794746583764 49.4574546775777,-113.795091614189 49.4574582729324,-113.795102643479 49.4570084474527,-113.795447670816 49.4570120417217,-113.79545318378 49.4567871289396,-113.796143235505 49.4567943143336,-113.796488261472 49.4567979054871,-113.796493769631 49.4565729926107,-113.796838794088 49.4565765827068,-113.796844300601 49.4563516697928,-113.797879369651 49.456362433822,-113.79788487136 49.4561375208137,-113.798229892936 49.4561411067371,-113.798240892993 49.4556912806363,-113.798585911482 49.4556948654741,-113.798613402528 49.4545702999188,-113.799303423932 49.4545774662244,-113.799308918779 49.454352553029,-113.799653928006 49.4543561346101,-113.799659421206 49.4541312213773,-113.800004428924 49.4541348019012,-113.800009920477 49.4539098886307,-113.800354926686 49.4539134680974,-113.800360416593 49.4536885547896,-113.800705421292 49.4536921331991,-113.800710909552 49.4534672198537,-113.801055912742 49.453470797206,-113.801061399356 49.4532458838231,-113.802096404604 49.453256609622,-113.802107368159 49.4528067826591,-113.802452366889 49.4528103558112,-113.802446886724 49.4530352693255,-113.803136887547 49.4530424125993,-113.803131410469 49.4532673261607,-113.803476412561 49.4532708962824,-113.803470936992 49.4534958098628,-113.803125933322 49.4534922397128,-113.803109501471 49.4541669803139,-113.803454509874 49.4541705505483,-113.803449034032 49.4543954640917,-113.803794044082 49.4543990333255,-113.803783095347 49.4548488604409,-113.804128108621 49.4548524287019,-113.804122635729 49.455077342274,-113.80446765065 49.4550809095342,-113.804451236297 49.4557556502793,-113.804796256021 49.4557592165951,-113.804790786011 49.4559841301865,-113.805135807381 49.4559876955014,-113.805141275813 49.4557627818819,-113.805486295674 49.4557663461396,-113.805491762459 49.4555414324827,-113.80583678081 49.4555449956833,-113.805831315603 49.4557699093684,-113.807211396002 49.4557841519933,-113.807205937039 49.4560090657816,-113.807550958888 49.4560126238934,-113.807545501435 49.4562375377004,-113.80789052493 49.4562410948113,-113.807885068987 49.4564660086373,-113.808230094128 49.4564695647472,-113.808224639695 49.4566944785919,-113.808569666483 49.4566980337009,-113.80856421356 49.4569229475645,-113.808909241994 49.4569265016725,-113.808903790581 49.4571514155549,-113.809248820661 49.4571549686619,-113.809243370758 49.4573798825631,-113.809588402485 49.4573834346691,-113.809582954092 49.4576083485891,-113.809927987466 49.457611899694,-113.809922540583 49.4578368136329,-113.810267575603 49.4578403637367,-113.81026213023 49.4580652776944,-113.810607166896 49.4580688267972,-113.810601723034 49.4582937407736,-113.812671953933 49.4583150139474,-113.812666519472 49.4585399280825,-113.813011559772 49.4585434700376,-113.813006126821 49.4587683841915,-113.813351168767 49.4587719251454,-113.813345737327 49.458996839318,-113.813690780919 49.4590003792707,-113.81368535099 49.459225293462,-113.814030396229 49.4592288324135,-113.81402496781 49.4594537466235,-113.814370014695 49.4594572845739,-113.814364587786 49.4596821988026,-113.814709636317 49.4596857357517,-113.81470421092 49.4599106499991,-113.815049261097 49.4599141859469,-113.81504383721 49.460139100213,-113.815733940926 49.4601461690771,-113.815728520128 49.4603710833897,-113.816073573666 49.4603746163059,-113.816068154379 49.4605995306372,-113.816413209563 49.4606030625521,-113.816407791787 49.460827976902,-113.816752848618 49.4608315078156,-113.816747432352 49.4610564221842,-113.817092490829 49.4610599520964,-113.817087076074 49.4612848664836,-113.817432136198 49.4612883953945,-113.817426722954 49.4615133098004)))";
            string error = ""; // introduced error
            string expectResult = $"{error}UPDATE public.\"{obj.GetType().Name}\" SET \"Geometry\" = {geomWKT} WHERE \"Id\" = {((BaseItem)obj).Id};";

            // Act
            string sql = new VectorImportor().GetUpdateGeometrySQL(obj, geomWKT);

            // Assert
            Assert.AreEqual(expectResult, sql);
        }
    }

}
